<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Compras Familiar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-4">
    <div id="app" class="max-w-md mx-auto"></div>

    <script>
        class ListaCompras {
            constructor() {
                this.usuarioActual = localStorage.getItem('nombreUsuario') || null;
                this.productos = [];
                this.categoriaSeleccionada = null;
                
                if (!this.usuarioActual) {
                    this.mostrarModalUsuario();
                } else {
                    this.iniciar();
                }
            }

            mostrarModalUsuario() {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
                        <div class="text-6xl mb-4">üëã</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">¬°Bienvenido!</h2>
                        <p class="text-gray-600 mb-6">Ingresa tu nombre para usar la lista familiar</p>
                        <input
                            type="text"
                            id="inputNombre"
                            placeholder="Tu nombre..."
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 text-lg mb-4"
                        />
                        <button
                            onclick="app.guardarUsuario()"
                            class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors"
                        >
                            Continuar
                        </button>
                    </div>
                `;
                
                const input = document.getElementById('inputNombre');
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.guardarUsuario();
                    }
                });
                input.focus();
            }

            guardarUsuario() {
                const input = document.getElementById('inputNombre');
                if (input && input.value.trim()) {
                    this.usuarioActual = input.value.trim();
                    localStorage.setItem('nombreUsuario', this.usuarioActual);
                    this.iniciar();
                }
            }

            iniciar() {
                this.cargarProductos();
                this.render();
            }

            cargarProductos() {
                const guardados = localStorage.getItem('listaComprasFamiliar');
                if (guardados) {
                    try {
                        this.productos = JSON.parse(guardados);
                    } catch (e) {
                        this.productos = [];
                    }
                }
            }

            guardarProductos() {
                localStorage.setItem('listaComprasFamiliar', JSON.stringify(this.productos));
            }

            agregarProducto(nombre, categoria) {
                if (nombre.trim() && categoria) {
                    this.productos.push({
                        id: Date.now(),
                        nombre: nombre.trim(),
                        categoria: categoria,
                        comprado: false,
                        compradoPor: null,
                        fechaCompra: null,
                        agregadoPor: this.usuarioActual
                    });
                    this.guardarProductos();
                    this.render();
                }
            }

            toggleComprado(id) {
                const producto = this.productos.find(p => p.id === id);
                if (producto) {
                    producto.comprado = !producto.comprado;
                    if (producto.comprado) {
                        producto.compradoPor = this.usuarioActual;
                        producto.fechaCompra = new Date().toISOString();
                    } else {
                        producto.compradoPor = null;
                        producto.fechaCompra = null;
                    }
                    this.guardarProductos();
                    this.render();
                }
            }

            eliminarProducto(id) {
                this.productos = this.productos.filter(p => p.id !== id);
                this.guardarProductos();
                this.render();
            }

            limpiarComprados() {
                this.productos = this.productos.filter(p => !p.comprado);
                this.guardarProductos();
                this.render();
            }

            render() {
                const pendientes = this.productos.filter(p => !p.comprado).length;
                const completados = this.productos.filter(p => p.comprado).length;

                // Agrupar productos por categor√≠a
                const categorias = {
                    'comida': { nombre: 'Comida', emoji: 'üçé', color: 'green' },
                    'limpieza': { nombre: 'Limpieza', emoji: 'üßπ', color: 'blue' },
                    'ba√±o': { nombre: 'Ba√±o', emoji: 'üöø', color: 'purple' }
                };

                const productosPorCategoria = {};
                Object.keys(categorias).forEach(cat => {
                    productosPorCategoria[cat] = this.productos.filter(p => p.categoria === cat);
                });

                const app = document.getElementById('app');
                app.innerHTML = `
                    <!-- Header -->
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-3">
                                <svg class="text-green-600" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                    <path d="M16 10a4 4 0 0 1-8 0"></path>
                                </svg>
                                <div>
                                    <h1 class="text-xl font-bold text-gray-800">Lista de Compras Familiar</h1>
                                    <p class="text-sm text-gray-500">üë§ ${this.usuarioActual}</p>
                                </div>
                            </div>
                            <button
                                onclick="app.verHistorial()"
                                class="text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg text-sm font-semibold"
                            >
                                üìã
                            </button>
                        </div>
                        <div class="flex gap-4 text-sm">
                            <span class="text-gray-600">üìù Pendientes: <strong>${pendientes}</strong></span>
                            <span class="text-gray-600">‚úÖ Comprados: <strong>${completados}</strong></span>
                        </div>
                    </div>

                    <!-- Input -->
                    <div class="bg-white rounded-2xl shadow-lg p-4 mb-4">
                        <input
                            type="text"
                            id="inputProducto"
                            placeholder="¬øQu√© necesitas comprar?"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 text-lg mb-3"
                        />
                        
                        <div class="flex gap-2 mb-3">
                            ${Object.keys(categorias).map(cat => `
                                <button
                                    onclick="app.seleccionarCategoria('${cat}')"
                                    id="btn-${cat}"
                                    class="flex-1 py-3 px-2 rounded-xl border-2 transition-all categoria-btn text-sm font-semibold border-gray-200 bg-white"
                                >
                                    <div>${categorias[cat].emoji}</div>
                                    <div class="text-xs">${categorias[cat].nombre}</div>
                                </button>
                            `).join('')}
                        </div>

                        <button
                            onclick="app.agregarDesdeInput()"
                            class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-semibold transition-colors"
                        >
                            + Agregar a la lista
                        </button>
                    </div>

                    <!-- Lista por categor√≠as -->
                    <div class="space-y-4 mb-4">
                        ${this.productos.length === 0 ? `
                            <div class="bg-white rounded-2xl shadow-lg p-8 text-center text-gray-400">
                                <svg class="mx-auto mb-3 opacity-30" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                    <path d="M16 10a4 4 0 0 1-8 0"></path>
                                </svg>
                                <p class="text-lg">Tu lista est√° vac√≠a</p>
                                <p class="text-sm">Agrega productos arriba</p>
                            </div>
                        ` : Object.keys(categorias).map(cat => {
                            const items = productosPorCategoria[cat];
                            if (items.length === 0) return '';
                            
                            const colorClasses = {
                                'green': 'border-green-300 bg-green-50',
                                'blue': 'border-blue-300 bg-blue-50',
                                'purple': 'border-purple-300 bg-purple-50'
                            };

                            return `
                                <div class="bg-white rounded-2xl shadow-lg p-4">
                                    <h3 class="text-lg font-bold text-gray-700 mb-3 flex items-center gap-2">
                                        <span class="text-2xl">${categorias[cat].emoji}</span>
                                        ${categorias[cat].nombre}
                                        <span class="text-sm font-normal text-gray-500">(${items.length})</span>
                                    </h3>
                                    <div class="space-y-2">
                                        ${items.map(p => `
                                            <div class="flex items-center gap-3 p-3 rounded-xl border-2 transition-all ${
                                                p.comprado ? 'bg-gray-50 border-gray-200' : colorClasses[categorias[cat].color]
                                            }">
                                                <button
                                                    onclick="app.toggleComprado(${p.id})"
                                                    class="flex-shrink-0 w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${
                                                        p.comprado ? 'bg-green-500 border-green-500' : 'bg-white border-gray-300'
                                                    }"
                                                >
                                                    ${p.comprado ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>' : ''}
                                                </button>
                                                <span class="flex-1 ${
                                                    p.comprado ? 'line-through text-gray-400' : 'text-gray-800 font-medium'
                                                }">
                                                    ${p.nombre}
                                                </span>
                                                <button
                                                    onclick="app.eliminarProducto(${p.id})"
                                                    class="text-red-500 hover:bg-red-50 p-2 rounded-lg transition-colors"
                                                >
                                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="3 6 5 6 21 6"></polyline>
                                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- Bot√≥n limpiar -->
                    ${completados > 0 ? `
                        <button
                            onclick="app.limpiarComprados()"
                            class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-xl font-semibold transition-colors"
                        >
                            Limpiar productos comprados (${completados})
                        </button>
                    ` : ''}
                `;

                // Agregar evento Enter al input
                const input = document.getElementById('inputProducto');
                if (input) {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.agregarDesdeInput();
                        }
                    });
                }

                // Restaurar categor√≠a seleccionada
                if (this.categoriaSeleccionada) {
                    this.actualizarBotonCategoria(this.categoriaSeleccionada);
                }
            }

            agregarDesdeInput() {
                const input = document.getElementById('inputProducto');
                if (input && input.value && this.categoriaSeleccionada) {
                    this.agregarProducto(input.value, this.categoriaSeleccionada);
                    input.value = '';
                    this.categoriaSeleccionada = null;
                    this.render();
                } else if (input && input.value && !this.categoriaSeleccionada) {
                    alert('Por favor selecciona una categor√≠a primero');
                }
            }

            seleccionarCategoria(categoria) {
                this.categoriaSeleccionada = categoria;
                this.actualizarBotonCategoria(categoria);
            }

            verHistorial() {
                const comprados = this.productos.filter(p => p.comprado);
                
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-4">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">üìã Historial de Compras</h2>
                            <button
                                onclick="app.render()"
                                class="text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg text-sm font-semibold"
                            >
                                ‚Üê Volver
                            </button>
                        </div>

                        ${comprados.length === 0 ? `
                            <div class="text-center py-12 text-gray-400">
                                <p class="text-lg">No hay productos comprados a√∫n</p>
                            </div>
                        ` : `
                            <div class="space-y-3">
                                ${comprados.map(p => {
                                    const fecha = new Date(p.fechaCompra);
                                    const fechaFormateada = fecha.toLocaleDateString('es-AR', {
                                        day: '2-digit',
                                        month: '2-digit',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                                    
                                    const categorias = {
                                        'comida': 'üçé',
                                        'limpieza': 'üßπ',
                                        'ba√±o': 'üöø'
                                    };

                                    return `
                                        <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200">
                                            <div class="flex items-start justify-between">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2 mb-1">
                                                        <span class="text-xl">${categorias[p.categoria]}</span>
                                                        <span class="font-semibold text-gray-800">${p.nombre}</span>
                                                    </div>
                                                    <div class="text-sm text-gray-600">
                                                        <span class="font-semibold text-green-600">‚úì ${p.compradoPor}</span>
                                                        <span class="mx-2">‚Ä¢</span>
                                                        <span>${fechaFormateada}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `}
                    </div>
                `;
            }

            actualizarBotonCategoria(categoria) {
                const colores = {
                    'comida': 'border-green-500 bg-green-100',
                    'limpieza': 'border-blue-500 bg-blue-100',
                    'ba√±o': 'border-purple-500 bg-purple-100'
                };

                // Resetear todos los botones
                document.querySelectorAll('.categoria-btn').forEach(btn => {
                    btn.className = 'flex-1 py-3 px-2 rounded-xl border-2 transition-all categoria-btn text-sm font-semibold border-gray-200 bg-white';
                });

                // Resaltar el seleccionado
                const btnSeleccionado = document.getElementById(`btn-${categoria}`);
                if (btnSeleccionado) {
                    btnSeleccionado.className = `flex-1 py-3 px-2 rounded-xl border-2 transition-all categoria-btn text-sm font-semibold ${colores[categoria]}`;
                }
            }
        }

        // Inicializar la aplicaci√≥n
        const app = new ListaCompras();
    </script>
</body>
</html>
